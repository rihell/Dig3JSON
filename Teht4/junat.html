<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otsikko</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <ul>
            <li><a href="liikennekamera.html">Liikennekamera</a></li>
            <li><a href="junat.html">Junat</a></li>
        </ul>
    </nav>
    <header>
        <h1>Mennäänkö junalla Tampereelle?</h1>
        <p>Kuinkahan usein junia menee?</p>
    </header>
    <div id="junat"></div>
    <script>
        // Haetaan Tampereen junat
        fetch('https://rata.digitraffic.fi/api/v1/live-trains/station/tpe?departing_trains=10&include_nonstopping=false')
        .then(response => response.json())
        .then(data => {
            console.log("Junadata: ", data); // Tarkistetaan data konsolista

            // Kutsutaan funktiota, joka käsittelee junadata
            naytaJunat(data);
        })
        .catch(error => {
            document.getElementById("junat").innerHTML = "<p>Tietojen haku epäonnistui.</p>" + error;
        });

        function naytaJunat(data) {
            var teksti = "";  // Tyhjä muuttuja, johon lisätään junatiedot

            // Käydään läpi jokainen juna (data[i] viittaa yhteen junaan)
            for (var i = 0; i < data.length; i++) {
                // Käydään läpi aikataulutiedot (data[i].timeTableRows on taulukko)
                for (var j = 0; j < data[i].timeTableRows.length; j++) {

                    // Tarkistetaan, onko asema Tampere (TPE) ja onko kyseessä lähtö (DEPARTURE)
                    if (data[i].timeTableRows[j].stationShortCode == "TPE" && data[i].timeTableRows[j].type == "DEPARTURE") {
                        
                        // Tarkistetaan, onko juna pitkän matkan juna
                        if (data[i].trainCategory == "Long-distance") {

                            // Saadaan lähtöasema (indeksi 0)
                            var lahtoasema = data[i].timeTableRows[0].stationShortCode;

                            // Saadaan määränpää (viimeinen indeksi)
                            var vika = data[i].timeTableRows.length - 1;
                            var maaranpaa = data[i].timeTableRows[vika].stationShortCode;

                            // Päivämäärän ja ajan käsittely
                            var pvm = data[i].timeTableRows[j].scheduledTime;
                            var aika = pvm.substr(0, 10) + " kello: " + pvm.substr(11, 5);

                            // Luodaan HTML-esitys tiedoista
                            teksti += "<div class='juna-info'>";
                            teksti += "<strong>Juna: </strong>" + data[i].trainType + " " + data[i].trainNumber + "<br>";
                            teksti += "<strong>Lähtöasema: </strong>" + lahtoasema + "<br>";
                            teksti += "<strong>Määränpää: </strong>" + maaranpaa + "<br>";
                            teksti += "<strong>Lähtöaika Tampereelta: </strong>" + aika + "<br>";
                            teksti += "</div>";
                            teksti += "<hr>"; // Viiva junien väliin
                        }
                    }
                }
            }

            // Näytetään tulokset HTML:ssä
            document.getElementById("junat").innerHTML = teksti;
        }
    </script>
</body>
</html>